<% layout('layouts/boilerPlate') %>

<article class="contact active" data-page="update-contact">
    <header>
        <h2 class="h2 article-title">Update Contacts</h2>
    </header>
    <%- include("../includes/admin-nav") %>

    <% if (action === 'add') { %>
    <section class="contact-form">
        <h3 class="h3 form-title">Add New Contact</h3>
        <form action="/updating/contact/add" method="POST" class="form">
            <div class="input-wrapper">
                <input type="text" id="name" name="name" class="form-input" placeholder="Name" required>
                <input type="email" id="email" name="email" class="form-input" placeholder="Email" required>
                <input type="text" id="phone" name="phone" class="form-input" placeholder="Phone" required>
            </div>
            <textarea id="message" name="message" class="form-input" placeholder="Message" required></textarea>
            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                <button type="submit" name="save_action" value="save" class="form-btn" style="flex: 1;">
                    <ion-icon name="add-outline"></ion-icon>
                    <span>Save</span>
                </button>
                <button type="submit" name="save_action" value="save_and_add_another" class="form-btn" style="flex: 1; background: var(--bg-gradient-onyx); border: 1px solid var(--jet);">
                    <ion-icon name="duplicate-outline"></ion-icon>
                    <span>Save & Add Another</span>
                </button>
            </div>
        </form>
    </section>
    <% } else if (action === 'delete') { %>
    <section class="service">
        <h3 class="h3 service-title">Delete Contact</h3>
        <% if (data && data.length > 0) { %>
        <form action="/updating/contact/delete-batch" method="POST" id="batchDeleteForm">
            <div style="margin-bottom: 1rem; display: flex; gap: 1rem;">
                <button type="button" class="form-btn" id="selectAllBtn" style="flex: 1; background: var(--bg-gradient-onyx); border: 1px solid var(--jet);">
                    <ion-icon name="checkbox-outline"></ion-icon>
                    <span>Select All</span>
                </button>
                <button type="submit" class="form-btn" style="flex: 1;">
                    <ion-icon name="trash-outline"></ion-icon>
                    <span>Delete Selected</span>
                </button>
            </div>
            <ul class="service-list">
                <% data.forEach(item => { %>
                <li class="service-item" style="display: flex; align-items: flex-start; gap: 15px; padding: 25px;">
                    <div style="padding-top: 5px;">
                        <input type="checkbox" name="ids[]" value="<%= item._id %>" style="width: 20px; height: 20px; cursor: pointer;">
                    </div>
                    <div class="service-icon-box" style="margin-bottom: 0; min-width: 40px; display: flex; justify-content: center;">
                        <ion-icon name="person-circle-outline" style="font-size: 30px; color: var(--orange-yellow-crayola);"></ion-icon>
                    </div>
                    <div style="flex: 1;">
                        <div class="service-content-box" style="text-align: left;">
                            <h4 class="h4 service-item-title" style="margin-bottom: 5px;"><%= item.name %></h4>
                            <p class="service-item-text" style="color: var(--light-gray); margin-bottom: 5px;">
                                <a href="mailto:<%= item.email %>" style="color: var(--orange-yellow-crayola);"><%= item.email %></a>
                            </p>
                            <p class="service-item-text" style="font-size: var(--fs-8); color: var(--light-gray-70);">
                                <%= item.message %>
                            </p>
                            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                                <a href="/contacts/<%= item._id %>/edit" class="form-btn" style="flex: 1; text-align: center;">
                                    <ion-icon name="create-outline"></ion-icon>
                                    <span>Edit</span>
                                </a>
                                <button type="button" onclick="if(confirm('Are you sure?')) { const form = document.createElement('form'); form.method = 'POST'; form.action = '/contacts/<%= item._id %>?_method=DELETE'; document.body.appendChild(form); form.submit(); }" class="form-btn" style="flex: 1; width: 100%;">
                                    <ion-icon name="trash-outline"></ion-icon>
                                    <span>Delete</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </li>
                <% }); %>
            </ul>
        </form>
        <script>
            document.getElementById('selectAllBtn').addEventListener('click', function() {
                const checkboxes = document.querySelectorAll('input[name="ids[]"]');
                const allChecked = Array.from(checkboxes).every(cb => cb.checked);
                checkboxes.forEach(cb => cb.checked = !allChecked);
                this.querySelector('span').textContent = allChecked ? 'Select All' : 'Deselect All';
            });
        </script>
        <% } else { %>
        <h6 style="color: rgb(84, 84, 82);">No items found.</h6>
        <% } %>
    </section>
    <% } else if (action === 'edit') { %>
    <section class="contact-form">
        <h3 class="h3 form-title">Edit Contact</h3>
        <form action="/contacts/<%= contact._id %>?_method=PUT" method="POST" class="form" enctype="multipart/form-data">
            <div class="input-wrapper">
                <input type="text" id="name" name="name" class="form-input" placeholder="Name" value="<%= contact.name %>" required>
                <input type="email" id="email" name="email" class="form-input" placeholder="Email" value="<%= contact.email %>" required>
                <input type="text" id="phone" name="phone" class="form-input" placeholder="Phone" value="<%= contact.phone %>">
            </div>
            <textarea id="message" name="message" class="form-input" placeholder="Message" required><%= contact.message %></textarea>

            <div class="input-wrapper" style="margin-top: 1rem;">
                <label for="attachment" class="form-label">Attachment:</label>
                <input type="file" id="attachment" name="attachment" class="form-input">
                <% if (contact.attachment && contact.attachment.url) { %>
                    <p>Current Attachment: <a href="<%= contact.attachment.url %>" target="_blank"><%= contact.attachment.filename %></a></p>
                    <div class="checkbox-wrapper">
                        <input type="checkbox" id="deleteAttachment" name="deleteAttachment" value="true">
                        <label for="deleteAttachment">Delete Current Attachment</label>
                    </div>
                <% } %>
            </div>

            <button type="submit" class="form-btn">
                <ion-icon name="pencil-outline"></ion-icon>
                <span>Update Contact</span>
            </button>
        </form>
    </section>
    <% } %>
</article>
